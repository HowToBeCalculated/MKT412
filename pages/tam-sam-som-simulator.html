<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EcoCharge Market Analysis ‚Äî Standalone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CDN (no build needed) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide icons (vanilla, not React) -->
  <script defer src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ===== Bryant theme ===== */
    :root {
      --bryant-dark: #1a1a1a;
      --surface: #242424;
      --surface-soft: #2a2a2a;
      --border: #333;
      --text: #e0e0e0;
      --muted: #bdbdbd;
      --accent: #e6a700; /* gold */
      --accent-ink: #1a1a1a;
    }
    body { font-family: 'Inter', sans-serif; background-color: var(--bryant-dark); color: var(--text); }
    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 0.75rem; }
    .card-soft { background: var(--surface-soft); border: 1px solid rgba(255,255,255,0.04); border-radius: 0.75rem; }
    .section-title { color: var(--accent); }
    .btn { padding: 0.4rem 0.75rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; }
    .btn-ghost { background: var(--surface-soft); color: var(--text); border: 1px solid #444; }
    .btn-ghost:hover { background: #333; }
    .btn-accent { background: var(--accent); color: var(--accent-ink); }
    .kbd { background: #111; border: 1px solid #444; padding: 0 6px; border-radius: 6px; font-size: 12px; }

    /* Inputs on dark */
    .input { background: #1f1f1f; color: var(--text); border: 1px solid #444; border-radius: 0.5rem; padding: 0.5rem 0.75rem; }
    .input:focus { outline: none; box-shadow: 0 0 0 2px var(--accent); border-color: var(--accent); }

    /* Table */
    table thead { background: #2a2a2a; }
    table th { color: var(--accent); font-weight: 700; }
    table td { color: var(--text); }

    /* Chart */
    .legend-dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:6px; }
    .track { background:#303030; border-radius:9999px; position:relative; height:12px; }
    .fill { height:12px; border-radius:9999px; }
    .fill-tam { background: var(--accent); }
    .fill-sam { background: #d8d8d8; }
    .fill-som { background: #ffffff; }

    /* Dev chip */
    #dev-chip { position: fixed; bottom: 12px; right: 12px; z-index: 50; }
  </style>
</head>
<body>
  <div class="max-w-6xl mx-auto p-6">
    <!-- Hero Section -->
    <div class="card p-8 mb-8">
      <div class="flex items-start gap-6">
        <div class="flex-shrink-0">
          <div class="w-20 h-20 bg-[var(--accent)] rounded-full flex items-center justify-center">
            <i data-lucide="zap" class="w-10 h-10" style="color:var(--accent-ink)"></i>
          </div>
        </div>
        <div class="flex-1">
          <h1 class="text-3xl font-bold mb-2">EcoCharge Network</h1>
          <h2 class="text-xl section-title font-semibold mb-4">Smart EV Charging Infrastructure for Urban America</h2>

          <div class="grid md:grid-cols-3 gap-4 mb-6">
            <div class="card-soft p-4">
              <div class="flex items-center mb-2">
                <i data-lucide="car" class="w-5 h-5 mr-2 section-title"></i>
                <span class="font-medium">The Vision</span>
              </div>
              <p class="text-sm text-[var(--muted)]">Ultra-fast charging stations with AI-powered grid optimization and renewable energy integration</p>
            </div>
            <div class="card-soft p-4">
              <div class="flex items-center mb-2">
                <i data-lucide="map-pin" class="w-5 h-5 mr-2 section-title"></i>
                <span class="font-medium">The Strategy</span>
              </div>
              <p class="text-sm text-[var(--muted)]">Target high-density urban areas, shopping centers, and highway corridors across North America</p>
            </div>
            <div class="card-soft p-4">
              <div class="flex items-center mb-2">
                <i data-lucide="battery" class="w-5 h-5 mr-2 section-title"></i>
                <span class="font-medium">The Edge</span>
              </div>
              <p class="text-sm text-[var(--muted)]">5-minute charging technology, mobile app integration, and dynamic pricing</p>
            </div>
          </div>

          <div class="card-soft p-4">
            <p class="font-medium">üéØ Your Mission:</p>
            <p class="text-[var(--muted)]">You're the founder presenting to Series A investors. They want to see your market opportunity analysis for the next 5 years.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Market Context -->
    <div class="card p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4 flex items-center section-title">
        <i data-lucide="info" class="w-5 h-5 mr-2 section-title"></i>
        Market Context: The EV Revolution
      </h2>

      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="font-semibold mb-3">üìä Market Drivers</h3>
          <ul class="space-y-2 text-sm text-[var(--muted)]">
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>EV sales growing 40%+ annually</li>
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>Government mandates: 50% EV by 2030</li>
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>Tesla opened Supercharger network</li>
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>$7.5B federal charging infrastructure fund</li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold mb-3">‚ö° Your Competitive Advantage</h3>
          <ul class="space-y-2 text-sm text-[var(--muted)]">
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>350kW ultra-fast charging (5-10 min top-ups)</li>
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>AI-powered demand prediction & pricing</li>
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>Renewable energy partnerships</li>
            <li class="flex items-start"><span class="section-title mr-2">‚Ä¢</span>Premium customer experience & app</li>
          </ul>
        </div>
      </div>

      <button id="toggleFramework" class="mt-4 flex items-center text-sm btn btn-ghost" type="button">
        <i data-lucide="info" class="w-4 h-4 mr-2 section-title"></i>
        <span id="frameworkToggleLabel">Show</span> TAM/SAM/SOM Framework
      </button>

      <div id="frameworkPanel" class="mt-4 card-soft p-4 hidden">
        <div class="grid md:grid-cols-3 gap-4">
          <div>
            <h3 class="font-semibold section-title mb-2">üåç TAM - Total Addressable Market</h3>
            <p class="text-sm text-[var(--muted)] mb-2">TAM = (Total Potential Customers) x (Average Revenue Per Customer)</p>
            <p class="text-sm text-[var(--muted)] mb-2">Global EV charging infrastructure market - what if every gas station became an EV charger?</p>
            <div class="text-xs text-gray-400">Includes all EV charging hardware, software, services worldwide</div>
          </div>
          <div>
            <h3 class="font-semibold section-title mb-2">üéØ SAM - Serviceable Available Market</h3>
            <p class="text-sm text-[var(--muted)] mb-2">SAM = (Target Segment Customers) x (Average Revenue Per Customer)</p>
            <p class="text-sm text-[var(--muted)] mb-2">North American urban markets where EcoCharge can realistically operate</p>
            <div class="text-xs text-gray-400">Limited by geography, regulations, and business model fit</div>
          </div>
          <div>
            <h3 class="font-semibold section-title mb-2">‚ö° SOM - Serviceable Obtainable Market</h3>
            <p class="text-sm text-[var(--muted)] mb-2">SOM = (Expected Market Share %) x (SAM)</p>
            <p class="text-sm text-[var(--muted)] mb-2">Market share EcoCharge can capture given competition and resources</p>
            <div class="text-xs text-gray-400">What you can realistically win in 5 years</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Strategy Scenarios -->
    <div class="card p-6 mb-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="font-semibold section-title">üöÄ Strategic Scenarios - Which Path Will You Take?</h2>
        <button id="resetBtn" type="button" class="btn btn-ghost" aria-label="Reset to Default Plan">Reset to Default</button>
      </div>
      <div id="scenarios" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
    </div>

    <!-- Input Controls -->
    <div class="grid lg:grid-cols-2 gap-8 mb-8">
      <!-- Market Size Inputs -->
      <div class="card p-6">
        <h2 class="text-xl font-semibold mb-4 flex items-center section-title">
          <i data-lucide="target" class="w-5 h-5 mr-2 section-title"></i>
          Market Sizing (2026)
        </h2>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" for="tamInput">üåç TAM - Global EV Charging Market</label>
            <div class="relative">
              <span class="absolute left-3 top-2 text-[var(--muted)]">$</span>
              <input id="tamInput" type="number" min="0" step="1000" class="input w-full pl-8 pr-16" />
              <span class="absolute right-3 top-2 text-[var(--muted)]">Million</span>
            </div>
            <div class="text-xs text-[var(--muted)] mt-1">All EV charging infrastructure globally</div>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="samPercentInput">üéØ SAM - North American Urban Markets</label>
            <div class="relative">
              <input id="samPercentInput" type="number" min="0" max="100" step="0.1" class="input w-full pr-8" />
              <span class="absolute right-3 top-2 text-[var(--muted)]">% of TAM</span>
            </div>
            <div id="samPreview" class="text-sm font-medium section-title mt-1">= $0M</div>
            <div class="text-xs text-[var(--muted)]">Major cities: NYC, LA, Chicago, Toronto, etc.</div>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="somPercentInput">‚ö° SOM - EcoCharge Market Share</label>
            <div class="relative">
              <input id="somPercentInput" type="number" min="0" max="100" step="0.1" class="input w-full pr-8" />
              <span class="absolute right-3 top-2 text-[var(--muted)]">% of SAM</span>
            </div>
            <div id="somPreview" class="text-sm font-medium" style="color:#ffffff">= $0M</div>
            <div class="text-xs text-[var(--muted)]">Your realistic revenue opportunity</div>
          </div>
        </div>
      </div>

      <!-- Growth Rate Inputs -->
      <div class="card p-6">
        <h2 class="text-xl font-semibold mb-4 flex items-center section-title">
          <i data-lucide="trending-up" class="w-5 h-5 mr-2 section-title"></i>
          Growth Projections
        </h2>

        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-2" for="tamGrowthInput">üåç TAM Growth Rate</label>
            <div class="relative">
              <input id="tamGrowthInput" type="number" min="0" max="100" step="0.1" class="input w-full pr-8" />
              <span class="absolute right-3 top-2 text-[var(--muted)]">%</span>
            </div>
            <div class="text-xs text-[var(--muted)] mt-1">Global EV adoption driving infrastructure demand</div>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="samGrowthInput">üéØ SAM Growth Rate</label>
            <div class="relative">
              <input id="samGrowthInput" type="number" min="0" max="100" step="0.1" class="input w-full pr-8" />
              <span class="absolute right-3 top-2 text-[var(--muted)]">%</span>
            </div>
            <div class="text-xs text-[var(--muted)] mt-1">Urban areas adopting EVs faster than rural</div>
          </div>

          <div>
            <label class="block text-sm font-medium mb-2" for="somGrowthInput">‚ö° SOM Growth Rate</label>
            <div class="relative">
              <input id="somGrowthInput" type="number" min="0" max="100" step="0.1" class="input w-full pr-8" />
              <span class="absolute right-3 top-2 text-[var(--muted)]">%</span>
            </div>
            <div class="text-xs text-[var(--muted)] mt-1">Your aggressive expansion plan</div>
          </div>
        </div>

        <div class="mt-4 card-soft p-4 rounded-md">
          <div class="text-xs text-[var(--muted)] space-y-1">
            <div><strong>üí° Growth Strategy:</strong></div>
            <div>‚Ä¢ Years 1‚Äì2: Focus on major metros</div>
            <div>‚Ä¢ Years 3‚Äì4: Highway corridors & suburbs</div>
            <div>‚Ä¢ Year 5: Secondary markets expansion</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Table -->
    <div class="card border rounded-lg shadow-lg mb-8">
      <div class="px-6 py-4 border-b border-[var(--border)] card-soft">
        <h2 class="text-xl font-semibold flex items-center"><i data-lucide="calculator" class="w-5 h-5 mr-2 section-title"></i>EcoCharge 5-Year Revenue Projections</h2>
        <p class="text-sm text-[var(--muted)] mt-1">Your potential revenue opportunity through 2030</p>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr>
              <th class="px-4 py-3 text-left text-xs uppercase">Year</th>
              <th class="px-4 py-3 text-left text-xs uppercase">Global Market (TAM)</th>
              <th class="px-4 py-3 text-left text-xs uppercase">Your Market (SAM)</th>
              <th class="px-4 py-3 text-left text-xs uppercase">Revenue Target (SOM)</th>
              <th class="px-4 py-3 text-left text-xs uppercase text-[var(--muted)]">Market Share</th>
              <th class="px-4 py-3 text-left text-xs uppercase text-[var(--muted)]">Stations*</th>
            </tr>
          </thead>
          <tbody id="resultsBody" class="divide-y divide-[var(--border)]"></tbody>
        </table>
      </div>
      <div class="px-4 py-2 text-xs text-[var(--muted)] card-soft border-t border-[var(--border)]">
        *Estimated charging stations based on $2.5M average annual revenue per station
      </div>
    </div>

    <!-- Visual Chart (themed colors) -->
    <div class="card border rounded-lg shadow-lg mb-8 p-6">
      <h2 class="text-xl font-semibold mb-4">üìà Market Growth Visualization</h2>
      <div class="space-y-4" id="chartContainer"></div>
      <div class="mt-3 text-sm flex gap-4">
        <span><span class="legend-dot" style="background:var(--accent)"></span>TAM</span>
        <span><span class="legend-dot" style="background:#d8d8d8"></span>SAM</span>
        <span><span class="legend-dot" style="background:#ffffff; border:1px solid #555"></span>SOM</span>
      </div>
    </div>

    <!-- Investment Summary -->
    <div class="card p-8">
      <h2 class="text-2xl font-bold mb-6 text-center section-title">üí∞ Investment Opportunity Summary</h2>

      <div class="grid md:grid-cols-4 gap-6 mb-6">
        <div class="card-soft p-6 text-center">
          <h3 class="font-semibold mb-2 section-title">Market Size (2030)</h3>
          <div id="summaryTam" class="text-3xl font-bold mb-1" style="color:var(--accent)">$0</div>
          <div class="text-sm text-[var(--muted)]">Global TAM</div>
        </div>

        <div class="card-soft p-6 text-center">
          <h3 class="font-semibold mb-2 section-title">Your Market (2030)</h3>
          <div id="summarySam" class="text-3xl font-bold mb-1" style="color:#d8d8d8">$0</div>
          <div class="text-sm text-[var(--muted)]">North America SAM</div>
        </div>

        <div class="card-soft p-6 text-center">
          <h3 class="font-semibold mb-2 section-title">Revenue Target</h3>
          <div id="summarySom" class="text-3xl font-bold mb-1" style="color:#ffffff">$0</div>
          <div class="text-sm text-[var(--muted)]">2030 Revenue</div>
        </div>

        <div class="card-soft p-6 text-center">
          <h3 class="font-semibold mb-2">Network Size</h3>
          <div id="summaryStations" class="text-3xl font-bold mb-1">0</div>
          <div class="text-sm text-[var(--muted)]">Charging Stations</div>
        </div>
      </div>

      <div class="card-soft p-6">
        <h3 class="font-bold text-lg mb-3 text-center">üéØ The Ask: Series A Funding</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-semibold mb-2">üíµ Funding Request:</h4>
            <p id="fundingAsk" class="text-sm text-[var(--muted)] mb-4">$75M Series A to capture 0.0B market opportunity</p>

            <h4 class="font-semibold mb-2">üöÄ Use of Funds:</h4>
            <ul class="text-sm text-[var(--muted)] space-y-1">
              <li>‚Ä¢ 60% - Infrastructure deployment (500+ stations)</li>
              <li>‚Ä¢ 25% - Technology development & AI platform</li>
              <li>‚Ä¢ 10% - Team expansion & operations</li>
              <li>‚Ä¢ 5% - Marketing & customer acquisition</li>
            </ul>
          </div>
          <div>
            <h4 class="font-semibold mb-2">üìä Key Metrics (Year 5):</h4>
            <ul class="text-sm text-[var(--muted)] space-y-1">
              <li>‚Ä¢ Revenue: <span id="metricRevenue">$0</span></li>
              <li>‚Ä¢ Market Share: <span id="metricShare">0%</span> of SAM</li>
              <li>‚Ä¢ Growth Rate: <span id="metricSomGrowth">0%</span> annually</li>
              <li>‚Ä¢ Growth Multiple: <span id="metricGrowthMultiple">0.0x</span></li>
              <li>‚Ä¢ Total Growth: <span id="metricTotalGrowthPercent">0%</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-black/80 text-white text-sm px-3 py-2 rounded shadow hidden" role="status" aria-live="polite"></div>
  <button id="dev-chip" class="btn btn-ghost hidden" type="button">üß™ Run Self‚ÄëCheck</button>

<script>
  // ----- State -----
  const state = {
    tam: 25000,
    samPercent: 12,
    somPercent: 8,
    tamGrowth: 28,
    samGrowth: 32,
    somGrowth: 45,
    results: [],
    showInfo: false,
    selectedScenarioIndex: 3,
    isCustom: false
  };

  const competitorScenarios = [
    { name: "Conservative Growth", description: "Playing it safe with steady expansion", tam: 25000, samPercent: 8, somPercent: 4, tamGrowth: 25, samGrowth: 28, somGrowth: 35 },
    { name: "Aggressive Expansion", description: "Going big with venture backing", tam: 25000, samPercent: 15, somPercent: 12, tamGrowth: 30, samGrowth: 35, somGrowth: 50 },
    { name: "Premium Markets Only", description: "Focus on high-income urban areas", tam: 25000, samPercent: 6, somPercent: 15, tamGrowth: 28, samGrowth: 40, somGrowth: 60 },
    { name: "Current Plan", description: "Balanced growth strategy", tam: 25000, samPercent: 12, somPercent: 8, tamGrowth: 28, samGrowth: 32, somGrowth: 45 }
  ];

  // ----- Utilities -----
  function formatCurrency(value) {
    return value >= 1000 ? `$${(value/1000).toFixed(1)}B` : `$${value.toFixed(0)}M`;
  }

  // ----- Elements -----
  const tamInput = document.getElementById('tamInput');
  const samPercentInput = document.getElementById('samPercentInput');
  const somPercentInput = document.getElementById('somPercentInput');
  const tamGrowthInput = document.getElementById('tamGrowthInput');
  const samGrowthInput = document.getElementById('samGrowthInput');
  const somGrowthInput = document.getElementById('somGrowthInput');
  const samPreview = document.getElementById('samPreview');
  const somPreview = document.getElementById('somPreview');
  const resultsBody = document.getElementById('resultsBody');
  const chartContainer = document.getElementById('chartContainer');
  const summaryTam = document.getElementById('summaryTam');
  const summarySam = document.getElementById('summarySam');
  const summarySom = document.getElementById('summarySom');
  const summaryStations = document.getElementById('summaryStations');
  const fundingAsk = document.getElementById('fundingAsk');
  const metricRevenue = document.getElementById('metricRevenue');
  const metricShare = document.getElementById('metricShare');
  const metricSomGrowth = document.getElementById('metricSomGrowth');
  const scenariosContainer = document.getElementById('scenarios');
  const frameworkPanel = document.getElementById('frameworkPanel');
  const toggleFrameworkBtn = document.getElementById('toggleFramework');
  const frameworkToggleLabel = document.getElementById('frameworkToggleLabel');

  // ----- Core calc -----
  function calculateProjections() {
    const { tam, samPercent, somPercent, tamGrowth, samGrowth, somGrowth } = state;
    const projections = [];
    for (let year = 0; year < 5; year++) {
      const currentTam = tam * Math.pow(1 + tamGrowth/100, year);
      const currentSam = (currentTam * samPercent/100) * Math.pow(1 + (samGrowth - tamGrowth)/100, year);
      const currentSom = (currentSam * somPercent/100) * Math.pow(1 + (somGrowth - samGrowth)/100, year);
      projections.push({ year: 2026 + year, tam: currentTam, sam: currentSam, som: currentSom });
    }
    state.results = projections;
  }

  // ----- Renderers -----
  function renderPreviews() {
    const samVal = state.tam * state.samPercent / 100;
    const somVal = samVal * state.somPercent / 100;
    samPreview.textContent = `= ${formatCurrency(samVal)}`;
    somPreview.textContent = `= ${formatCurrency(somVal)}`;
  }

  function renderResultsTable() {
    const avgRevenuePerStation = 2.5;
    const rows = state.results.map((r, idx) => {
      const stationCount = Math.round(r.som / avgRevenuePerStation).toLocaleString();
      const yearBadge = idx === 0 ? '<span class="text-[var(--accent)] text-xs ml-1">(Launch)</span>' : '';
      return `
        <tr class="hover:bg-black/10">
          <td class="px-4 py-3 text-sm font-medium">${r.year}${yearBadge}</td>
          <td class="px-4 py-3 text-sm font-semibold" style="color:var(--accent)">${formatCurrency(r.tam)}</td>
          <td class="px-4 py-3 text-sm font-semibold" style="color:#d8d8d8">${formatCurrency(r.sam)}</td>
          <td class="px-4 py-3 text-sm font-bold" style="color:#ffffff">${formatCurrency(r.som)}</td>
          <td class="px-4 py-3 text-sm text-[var(--muted)]">${((r.som/r.sam)*100).toFixed(1)}%</td>
          <td class="px-4 py-3 text-sm text-[var(--muted)]">~${stationCount}</td>
        </tr>`;
    }).join('');
    resultsBody.innerHTML = rows;
  }

  function renderChart() {
    const maxTam = Math.max(...state.results.map(r => r.tam));
    const blocks = state.results.map((r, idx) => {
      const wTam = (r.tam / maxTam) * 100;
      const wSam = (r.sam / maxTam) * 100;
      const wSom = (r.som / maxTam) * 100;
      return `
        <div class="space-y-2">
          <div class="flex items-center text-sm font-medium">
            <div class="w-12">${r.year}</div>
            ${idx===0?'<span class="text-[var(--accent)] ml-2 text-xs">Launch Year</span>':''}
            ${idx===4?'<span class="text-green-400 ml-2 text-xs">Series A Target</span>':''}
          </div>
          <div class="flex items-center">
            <div class="w-20 text-xs font-medium" style="color:var(--accent)">Global TAM</div>
            <div class="flex-1 mx-2 track"><div class="fill fill-tam" style="width:${wTam}%"></div></div>
            <div class="text-xs ml-2">${formatCurrency(r.tam)}</div>
          </div>
          <div class="flex items-center">
            <div class="w-20 text-xs font-medium" style="color:#d8d8d8">Your SAM</div>
            <div class="flex-1 mx-2 track"><div class="fill fill-sam" style="width:${wSam}%"></div></div>
            <div class="text-xs ml-2">${formatCurrency(r.sam)}</div>
          </div>
          <div class="flex items-center mb-4">
            <div class="w-20 text-xs font-medium" style="color:#ffffff">Revenue</div>
            <div class="flex-1 mx-2 track"><div class="fill fill-som" style="width:${wSom}%"></div></div>
            <div class="text-xs ml-2">${formatCurrency(r.som)}</div>
          </div>
        </div>`;
    }).join('');
    chartContainer.innerHTML = blocks;
  }

  function renderSummary() {
    if (!state.results.length) return;
    const y5 = state.results[4];
    const y1 = state.results[0];
    summaryTam.textContent = formatCurrency(y5.tam);
    summarySam.textContent = formatCurrency(y5.sam);
    summarySom.textContent = formatCurrency(y5.som);
    summaryStations.textContent = Math.round(y5.som / 2.5).toLocaleString();
    fundingAsk.textContent = `$75M Series A to capture ${(y5.som/1000).toFixed(1)}B market opportunity`;
    metricRevenue.textContent = formatCurrency(y5.som);
    metricShare.textContent = ((y5.som / y5.sam) * 100).toFixed(1) + '%';
    metricSomGrowth.textContent = `${state.somGrowth}%`;
    const multiple = y5.som / y1.som;
    const pct = (multiple - 1) * 100;
    document.getElementById('metricGrowthMultiple').textContent = `${multiple.toFixed(1)}x`;
    document.getElementById('metricTotalGrowthPercent').textContent = `${pct.toFixed(0)}%`;
  }

  // ----- Orchestrator -----
  function updateAll() {
    calculateProjections();
    renderPreviews();
    renderResultsTable();
    renderChart();
    renderSummary();
  }

  // ----- Scenarios UI -----
  function renderScenarios() {
    scenariosContainer.innerHTML = '';
    competitorScenarios.forEach((s, idx) => {
      const isSelected = state.selectedScenarioIndex === idx;
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = `p-4 rounded-lg border-2 text-left transition-all ${isSelected ? 'border-[var(--accent)] bg-black/20' : 'border-[#444] bg-transparent hover:border-[var(--accent)]'}`;
      const displayName = (idx===3) ? (state.isCustom ? 'Custom' : 'Default') : s.name;
      btn.innerHTML = `
        <div class="font-medium text-sm mb-1">${displayName}</div>
        <div class="text-xs text-[var(--muted)] mb-3">${s.description}</div>
        <div class="space-y-1 text-xs">
          <div>SAM: ${s.samPercent}% of TAM</div>
          <div>SOM: ${s.somPercent}% of SAM</div>
          <div class="font-medium" style="color:var(--accent)">Growth: ${s.tamGrowth}-${s.somGrowth}%</div>
        </div>`;
      btn.addEventListener('click', () => loadScenarioByIndex(idx));
      scenariosContainer.appendChild(btn);
    });
  }

  function loadScenarioByIndex(idx) {
    const s = competitorScenarios[idx];
    state.tam = s.tam; state.samPercent = s.samPercent; state.somPercent = s.somPercent;
    state.tamGrowth = s.tamGrowth; state.samGrowth = s.samGrowth; state.somGrowth = s.somGrowth;
    state.isCustom = false; state.selectedScenarioIndex = idx;
    tamInput.value = state.tam; samPercentInput.value = state.samPercent; somPercentInput.value = state.somPercent;
    tamGrowthInput.value = state.tamGrowth; samGrowthInput.value = state.samGrowth; somGrowthInput.value = state.somGrowth;
    updateAll(); renderScenarios(); showToast(`${idx===3?'Default':s.name} applied`);
  }

  // ----- Inputs binding -----
  function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }
  function bindInputs() {
    const refresh = debounce(()=>{ updateAll(); renderScenarios(); }, 120);
    const onEdit = (setter) => (e)=>{ setter(parseFloat(e.target.value)||0); state.isCustom=true; state.selectedScenarioIndex=3; refresh(); };
    tamInput.addEventListener('input', onEdit(v=>state.tam=v));
    samPercentInput.addEventListener('input', onEdit(v=>state.samPercent=v));
    somPercentInput.addEventListener('input', onEdit(v=>state.somPercent=v));
    tamGrowthInput.addEventListener('input', onEdit(v=>state.tamGrowth=v));
    samGrowthInput.addEventListener('input', onEdit(v=>state.samGrowth=v));
    somGrowthInput.addEventListener('input', onEdit(v=>state.somGrowth=v));
  }

  // ----- Framework panel toggle -----
  function initFrameworkToggle(){
    toggleFrameworkBtn.addEventListener('click', ()=>{
      state.showInfo = !state.showInfo;
      frameworkPanel.classList.toggle('hidden', !state.showInfo);
      frameworkToggleLabel.textContent = state.showInfo ? 'Hide' : 'Show';
    });
  }

  function primeInputs(){
    tamInput.value = state.tam; samPercentInput.value = state.samPercent; somPercentInput.value = state.somPercent;
    tamGrowthInput.value = state.tamGrowth; samGrowthInput.value = state.samGrowth; somGrowthInput.value = state.somGrowth;
  }

  function showToast(msg){ const t=document.getElementById('toast'); if(!t) return; t.textContent=msg; t.classList.remove('hidden'); clearTimeout(window.__toastTimer); window.__toastTimer=setTimeout(()=>t.classList.add('hidden'),1200); }

  // ----- Self-check (smoke tests) -----
  function runSelfCheck(){
    const tests=[]; const assert=(n,c)=>tests.push({n,pass:!!c}); const snap=JSON.parse(JSON.stringify(state));
    state.tam=1000; state.samPercent=10; state.somPercent=10; state.tamGrowth=0; state.samGrowth=0; state.somGrowth=0; calculateProjections();
    const y1=state.results[0], y5=state.results[4];
    assert('T1 Y1 TAM', Math.abs(y1.tam-1000)<1e-9);
    assert('T1 Y5 SOM unchanged', Math.abs(y5.som-10)<1e-9);
    loadScenarioByIndex(1); const btn = document.getElementById('scenarios').children[1];
    assert('T2 scenario selected', state.selectedScenarioIndex===1 && btn.className.includes('border'));
    tamInput.value=12345; tamInput.dispatchEvent(new Event('input',{bubbles:true}));
    const btn4=document.getElementById('scenarios').children[3];
    assert('T3 custom mode', state.isCustom===true && btn4.className.includes('border'));
    Object.assign(state,snap); primeInputs(); updateAll(); renderScenarios();
    const passed=tests.filter(t=>t.pass).length; console.log(`Self-Check ${passed}/${tests.length}`); alert(`Self-Check: ${passed}/${tests.length} passed`);
  }

  // ----- Boot -----
  document.addEventListener('DOMContentLoaded', () => {
    if (window.lucide?.createIcons) window.lucide.createIcons();
    renderScenarios(); bindInputs(); initFrameworkToggle(); primeInputs(); updateAll();
    const resetBtn=document.getElementById('resetBtn');
    resetBtn?.addEventListener('click', ()=>{ const s=competitorScenarios[3]; Object.assign(state,{...s,isCustom:false,selectedScenarioIndex:3}); primeInputs(); updateAll(); renderScenarios(); showToast('Reset to Default'); });
    document.getElementById('dev-chip')?.addEventListener('click', runSelfCheck);
  });
</script>
</body>
</html>
